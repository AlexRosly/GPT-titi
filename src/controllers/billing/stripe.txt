‚úÖ –®–∞–≥ 8. Stripe CLI (–ª–æ–∫–∞–ª—å–Ω–æ)

stripe login
stripe listen --forward-to localhost:7000/api/webhook/stripe

CLI –≤—ã–¥–∞—Å—Ç:
whsec_********
üëâ –≤—Å—Ç–∞–≤—å –≤ .env

‚úÖ –®–∞–≥ 9. –ö–∞–∫ —Ñ—Ä–æ–Ω—Ç –ø–æ–∫—É–ø–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã
POST /billing/checkout
Authorization: Bearer ACCESS_TOKEN

{
  "priceId": "price_1XXXX"
}
–û—Ç–≤–µ—Ç:
{
  "url": "https://checkout.stripe.com/..."
}

‚úÖ –®–∞–≥ 5. –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /billing/payments

[
  {
    "_id": "65af9...",
    "priceId": "price_1XXXX",
    "amount": 100,
    "currency": "eur",
    "appTokensAdded": 1000,
    "status": "paid",
    "createdAt": "2025-01-12T12:31:22.000Z"
  }
]
///////////////////////////////
‚úÖ –®–∞–≥ 5. –ö–∞–∫ —Ñ—Ä–æ–Ω—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
1Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—å –ø–∞–∫–µ—Ç—ã
GET /billing/prices


–û—Ç–≤–µ—Ç:

[
  {
    "stripePriceId": "price_1XXXX",
    "label": "Starter ‚Äî 1 000 tokens",
    "appTokens": 1000,
    "amount": 500,
    "currency": "eur"
  }
]

2Ô∏è‚É£ –ö—É–ø–∏—Ç—å
POST /billing/checkout
Authorization: Bearer ACCESS_TOKEN
{
  "priceId": "price_1XXXX"
}


–û—Ç–≤–µ—Ç:

{ "url": "https://checkout.stripe.com/..." }


‚û°Ô∏è window.location.href = url

üéØ –ò–¢–û–ì

‚úî TOKENS_BY_PRICE —É–±—Ä–∞–ª–∏
‚úî –í—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î
‚úî –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã –±–µ–∑ –¥–µ–ø–ª–æ—è
‚úî Webhook –±–µ–∑–æ–ø–∞—Å–Ω—ã–π
‚úî –§—Ä–æ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —Ç–∞—Ä–∏—Ñ–æ–≤
